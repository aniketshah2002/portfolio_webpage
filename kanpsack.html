<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Programming: Knapsack Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        .panel {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            transition: all 0.3s ease-in-out;
        }
        .grid-container {
            display: grid;
            grid-template-columns: auto repeat(11, minmax(0, 1fr));
            border-radius: 0.5rem;
            overflow: hidden;
            border: 1px solid #d1d5db;
        }
        .grid-cell {
            padding: 0.75rem;
            text-align: center;
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 500;
            background-color: #f9fafb;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            min-width: 50px;
        }
        .grid-cell.header {
            background-color: #1f2937;
            color: #f3f4f6;
            font-weight: 700;
        }
        .grid-cell.highlight-read {
            background-color: #d1fae5; /* Green */
            transform: scale(1.05);
        }
        .grid-cell.highlight-write {
            background-color: #a7f3d0; /* Lighter Green */
            transform: scale(1.05);
        }
        .grid-cell.highlight-solution {
            background-color: #34d399; /* Even lighter green */
        }
        .selected-item {
            background-color: #bfdbfe;
            animation: pulse-item 1s infinite alternate;
        }
        .item-row {
            transition: background-color 0.3s ease;
        }
        @keyframes pulse-item {
            from {
                transform: scale(1);
            }
            to {
                transform: scale(1.05);
            }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container py-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2">The Knapsack Problem Visualizer</h1>
            <p class="text-lg text-gray-600">Watch Dynamic Programming solve the problem of a smart thief!</p>
        </header>

        <!-- Control Panel -->
        <div class="panel flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0 md:space-x-4">
            <div class="flex-1 flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4 w-full">
                <label for="capacity" class="text-lg font-medium text-gray-700">Knapsack Capacity (kg):</label>
                <input type="number" id="capacity" value="10" min="1" max="50" class="w-24 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-center">
                <button id="startBtn" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold shadow-md hover:bg-blue-700 transition duration-300 ease-in-out">
                    Start Simulation
                </button>
                <div id="statusMessage" class="text-sm italic text-gray-500 mt-2 sm:mt-0">Adjust the capacity and click "Start".</div>
            </div>
        </div>

        <!-- Items and Solution Display -->
        <div class="panel flex flex-col lg:flex-row justify-between space-y-6 lg:space-y-0 lg:space-x-6">
            <div class="flex-1">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Available Items:</h2>
                <ul id="itemsList" class="space-y-2">
                    <!-- Items will be populated here by JavaScript -->
                </ul>
            </div>
            <div class="flex-1">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Optimal Solution:</h2>
                <div id="solutionDisplay" class="text-lg text-gray-700 space-y-2">
                    <p id="totalValue" class="font-bold text-gray-900 text-xl">Total Value: $0</p>
                    <p id="totalWeight" class="text-gray-600">Total Weight: 0 kg</p>
                    <ul id="solutionItems" class="list-disc list-inside mt-2 text-gray-700"></ul>
                </div>
            </div>
        </div>

        <!-- DP Grid Visualization -->
        <div class="panel">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Dynamic Programming Grid:</h2>
            <div id="dpGrid" class="overflow-x-auto">
                <div id="gridContainer" class="grid-container">
                    <!-- Grid will be dynamically created here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Array of items with their weight and value.
        // The first item is a placeholder for the DP table's base case.
        const items = [
            { name: "Item 0", weight: 0, value: 0 },
            { name: "Laptop", weight: 4, value: 12 },
            { name: "Jewelry Box", weight: 3, value: 8 },
            { name: "Antique Vase", weight: 5, value: 14 },
            { name: "Rare Book", weight: 2, value: 6 }
        ];

        // DOM element references
        const capacityInput = document.getElementById('capacity');
        const startBtn = document.getElementById('startBtn');
        const gridContainer = document.getElementById('gridContainer');
        const statusMessage = document.getElementById('statusMessage');
        const itemsList = document.getElementById('itemsList');
        const totalValueDisplay = document.getElementById('totalValue');
        const totalWeightDisplay = document.getElementById('totalWeight');
        const solutionItemsList = document.getElementById('solutionItems');
        let isSimulating = false;

        // Function to create and display the items list
        function renderItems() {
            itemsList.innerHTML = '';
            for (let i = 1; i < items.length; i++) {
                const item = items[i];
                const li = document.createElement('li');
                li.id = `item-${i}`;
                li.className = 'item-row bg-gray-50 px-4 py-2 rounded-lg';
                li.innerHTML = `<span class="font-medium">${item.name}</span>: Weight = ${item.weight}kg, Value = $${item.value}`;
                itemsList.appendChild(li);
            }
        }

        // Function to create the dynamic DP grid
        function createGrid(capacity) {
            gridContainer.innerHTML = '';
            // Set up grid columns dynamically
            gridContainer.style.gridTemplateColumns = `auto repeat(${capacity}, minmax(0, 1fr))`;

            // Create the headers for the grid
            const headers = ['Weight \u2192', ...Array.from({ length: capacity }, (_, i) => i + 1)];
            headers.forEach(header => {
                const cell = document.createElement('div');
                cell.className = 'grid-cell header';
                cell.textContent = header;
                gridContainer.appendChild(cell);
            });

            // Create the main grid cells
            for (let i = 0; i < items.length; i++) {
                const rowHeader = document.createElement('div');
                rowHeader.className = 'grid-cell header';
                rowHeader.textContent = items[i].name;
                gridContainer.appendChild(rowHeader);
                for (let j = 0; j <= capacity; j++) {
                    const cell = document.createElement('div');
                    cell.id = `cell-${i}-${j}`;
                    cell.className = 'grid-cell';
                    cell.textContent = '0';
                    gridContainer.appendChild(cell);
                }
            }
        }

        // Asynchronous function to add a delay
        const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // The core dynamic programming simulation function
        async function runSimulation() {
            if (isSimulating) return;
            isSimulating = true;
            startBtn.disabled = true;
            statusMessage.textContent = 'Simulation started...';

            // Clear previous results
            solutionItemsList.innerHTML = '';
            totalValueDisplay.textContent = 'Total Value: $0';
            totalWeightDisplay.textContent = 'Total Weight: 0 kg';

            const capacity = parseInt(capacityInput.value);
            if (isNaN(capacity) || capacity <= 0) {
                statusMessage.textContent = 'Please enter a valid capacity (> 0).';
                isSimulating = false;
                startBtn.disabled = false;
                return;
            }

            // Create the DP table (V) and the decision table (S)
            const V = Array(items.length).fill(null).map(() => Array(capacity + 1).fill(0));
            const S = Array(items.length).fill(null).map(() => Array(capacity + 1).fill(0));

            createGrid(capacity);

            // The main DP loop for visualization
            for (let i = 1; i < items.length; i++) {
                const currentItem = items[i];
                // Highlight the current item being processed
                document.getElementById(`item-${i}`).classList.add('selected-item');
                await delay(500);

                for (let w = 1; w <= capacity; w++) {
                    const cell = document.getElementById(`cell-${i}-${w}`);
                    
                    // Case 1: Item is too heavy to be included
                    if (currentItem.weight > w) {
                        statusMessage.textContent = `Item ${i} (${currentItem.name}) is too heavy (${currentItem.weight}kg) for weight capacity ${w}kg. Taking value from the row above.`;
                        V[i][w] = V[i - 1][w];
                        S[i][w] = S[i - 1][w];

                        // Highlight the cell being read from
                        document.getElementById(`cell-${i-1}-${w}`).classList.add('highlight-read');
                        await delay(200);

                        cell.textContent = V[i][w];
                        cell.classList.add('highlight-write');
                        await delay(200);

                        document.getElementById(`cell-${i-1}-${w}`).classList.remove('highlight-read');

                    } else {
                        // Case 2: Compare two options
                        statusMessage.textContent = `Considering Item ${i} (${currentItem.name}) for capacity ${w}kg.`;
                        
                        // Option A: Don't take the item
                        const valueWithoutItem = V[i - 1][w];
                        document.getElementById(`cell-${i-1}-${w}`).classList.add('highlight-read');

                        // Option B: Take the item
                        const valueWithItem = currentItem.value + V[i - 1][w - currentItem.weight];
                        document.getElementById(`cell-${i-1}-${w - currentItem.weight}`).classList.add('highlight-read');

                        await delay(500);

                        // Choose the better option
                        if (valueWithItem > valueWithoutItem) {
                            statusMessage.textContent += ` Taking the item! New value: $${valueWithItem}.`;
                            V[i][w] = valueWithItem;
                            S[i][w] = 1; // 1 means "take"
                        } else {
                            statusMessage.textContent += ` Not taking the item. Value remains $${valueWithoutItem}.`;
                            V[i][w] = valueWithoutItem;
                            S[i][w] = 0; // 0 means "don't take"
                        }
                        
                        document.getElementById(`cell-${i-1}-${w}`).classList.remove('highlight-read');
                        document.getElementById(`cell-${i-1}-${w - currentItem.weight}`).classList.remove('highlight-read');

                        cell.textContent = V[i][w];
                        cell.classList.add('highlight-write');
                        await delay(200);
                    }
                    cell.classList.remove('highlight-write');
                }
                document.getElementById(`item-${i}`).classList.remove('selected-item');
            }

            statusMessage.textContent = 'Simulation complete. Now finding the solution...';
            await delay(1000);

            // Backtracking to find the optimal items
            let w = capacity;
            let currentWeight = 0;
            const finalItems = [];
            for (let i = items.length - 1; i >= 1; i--) {
                const cell = document.getElementById(`cell-${i}-${w}`);
                cell.classList.add('highlight-solution');
                await delay(200);

                if (S[i][w] === 1) {
                    finalItems.push(items[i]);
                    currentWeight += items[i].weight;
                    w -= items[i].weight;
                    statusMessage.textContent = `Found Item ${items[i].name} in the solution! Remaining capacity to trace: ${w}kg.`;
                    await delay(500);
                } else {
                    statusMessage.textContent = `Item ${items[i].name} was not taken. Continuing trace...`;
                    await delay(500);
                }
            }

            // Display the final solution
            const finalValue = V[items.length - 1][capacity];
            totalValueDisplay.textContent = `Total Value: $${finalValue}`;
            totalWeightDisplay.textContent = `Total Weight: ${currentWeight} kg`;
            solutionItemsList.innerHTML = finalItems.reverse().map(item => `<li>${item.name} ($${item.value})</li>`).join('');

            statusMessage.textContent = 'Optimal solution found!';
            isSimulating = false;
            startBtn.disabled = false;
        }

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            renderItems();
            createGrid(parseInt(capacityInput.value));
            startBtn.addEventListener('click', runSimulation);
        });
    </script>
</body>
</html>
